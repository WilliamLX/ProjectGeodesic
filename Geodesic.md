# Project Geodesic: 固定基座双臂智能拧紧机器人
## 1. 传统算法方案
- 固定基座方案 (Fixed Base)
    - 消除移动底盘的晃动误差,刚性立柱安装，无需导航算法
    - 地轨，如果单臂无法覆盖，可以考虑增加地轨或者双臂各负责一边
- 闭环控制流程
    - 1. 示教
        - 摆放标准件： 把一块标准的panel，摆放在工装台车的理想位置上。
        - 拍照存档： 机器人使用头顶的3D相机拍一张照片。系统会把这张照片里的点云数据（物体表面的3D轮廓）保存下来，作为“标准模板”。
        - 人工标注位置： 在电脑屏幕显示的照片上，用鼠标依次点击那13个螺丝孔。系统记录每个螺丝孔的顺序。同时把图片上的2D点与机械臂操作的3D坐标进行绑定。
    - 2. 全局粗定位：输出4x4的变换矩阵 T
        - 数据预处理算法：体素滤波 (Voxel Grid Filter)，让计算在毫秒级完成。
        - 粗配准：PCA 或 特征匹配 (FPFH)，完成大方向对齐。
        - 精配准算法
            - ICP，计算毫米级的误差
            - Point-to-Plane ICP，“点到面”的变种算法，利用法向量信息
    - 3. 全局进场
        - 生成预备位：基于生成的T，生成Approach Pose，沿着孔位的法向量n（Z轴反方向）倒退距离d。MecMind相机最佳工作距离范围和最佳成像焦距16-35cm，建议d = 20。
        - 路径规划
            - MoveIt
            - 计算可达性，碰撞检测，生成轨迹
            -*GPU加速：Isaac cuMotion
    - 4. Visual Servo (视觉伺服)：IBVS，大概率 Mech-Vision已经有了
        - 图像采集
            - 使用手腕上的相机拍摄2D图像或3D点云
            - 可能需要考虑柔性补光
        - 寻找螺丝孔圆心
            - 传统算法：如果光照控制得好，使用 Blob Detection（斑点检测） 或 Hough Circle Transform（霍夫圆变换） 提取黑色圆孔。
            - 深度学习：YOLOv8
            - *VLM：NanoSam，FastSam，基于语义理解，可以处理反光，黑色，遮挡的问题。
        - 误差计算：计算观测螺丝孔中心对应工具的中心的偏移量，像素误差
        - 速度控制
            - 将像素误差，配合pid控制，直接发送机械臂移动指令
            - 迭代直至收敛
                - 30-50Hz
                - 当像素误差小于阈值
                - 向量角度偏差
    - 5. 执行：阻抗控制拧紧
        - 沿工具坐标系Z轴缓慢下降
        - 需要力控监控
            - 如果移动距离小于d，且Z轴的阻力大于一个阈值，则认为失败，需要停止
        - 螺旋搜索入孔
            - 在X-Y平面上做极小螺旋和摆动。
            - 监测 Z 轴位置。如果 Z 轴突然向下“掉”了一段距离（通常是螺丝导向柱的高度），说明螺丝尖端成功滑入孔内。
            - 成功入孔，准备拧紧
            - *Diffusion Policy 替代“螺旋搜索”：遥操作示教采集数据，Image-Based CNN Diffusion Policy
        - 预拧紧和拧紧
        - 收集数据，判定拧紧是否成功
    - 6. 完成：回到进场位置，准备移动至下个螺丝孔的进场位置。

## 2. 系统架构 (System Architecture)
- 硬件Setup
    - 计算核心: 
        - NVIDIA Jetson AGX Orin (运行 ROS 2) 
        - 工控机：GPU: RTX 5090，CPU: Intel Core i9，内存: 64GB 或 128GB DDR5，相机采集卡: PCIe 转 GMSL 卡
    - 机器人: 天机 Marvin 上半身 (固定于刚性立柱)
    - 视觉系统
        - 眼到手: 1x MecMind Pro (头部/顶端) -> 粗定位
        - 眼在手: 1x MecMind Nano (手腕) -> 视觉伺服
    - 执行末端
        - 1x Atlas Copco 直柄电枪 (左右各一)
        - 1x 自动送钉机
- 软件算法栈 (ROS 2) 
    - 感知层 (Perception)
        - 点云 ICP 配准 (解决工件位置随机)
        - Blob/3D边缘检测 (解决黑色反光件)
        - YoloV8 螺丝孔洞检测
        - 双路 IBVS 视觉伺服 (独立修正误差)
    - 规划层 (Planning)
        - MoveIt 2 多臂规划组
        - 碰撞检测 (自碰撞/环境碰撞)
    - 控制层 (Control)
        - 螺旋搜索 (Spiral Search) 入孔策略
        - 阻抗控制 (Impedance Control) 柔顺拧紧
    - 交互与逻辑
        - 行为树 (Behavior Tree) 任务编排
        - PyQt 示教界面 (Setup)
        - 大模型自动生成任务树

## 3. 开发计划 (4个月) 
- Month 1: 仿真与硬件固定
    - W1-W4: 硬件采购 & 刚性立柱设计
        - 天机
        - Atlas
        - Mec-Mind相机
    - W1-W3: 蔚来工厂生产环境实验室复现
        - 工位，工具，光照等
        - 重点复现光照干扰
    - W2-W5: 仿真环境建立（Isaac Sim）
        - 验证单臂/双臂能否覆盖所有孔位
        - 通信接口开发
    - W4: 双臂手眼标定 (Hand-Eye Calibration)
        - Mech-Vision自带标定的源生工具
- Month 2: 视觉攻关
    - W5-W8: 全局配准 (ICP) 开发
        - 目标：工件随意放置，定位误差 < 5mm
    - W5-W8: 视觉伺服 (IBVS) 开发
        - 目标：黑色孔位对准误差 < 0.5mm
    - 里程碑: 视觉锁定 (双臂自动追踪孔位)
- Month 3: 工艺与协作
    - W9-W12: 螺旋搜索与力控调试
        - 目标：柔顺入孔，不伤螺纹
        - 针对塑料件的“柔性入扣”参数
        - 集成 Atlas 电枪拧紧
        - 异常处理逻辑 
    - 里程碑: 实验室全流程跑通
- Month 4: 测试与优化
    - W13-16:
        - 细节优化
        - 尝试压缩节拍
    - W16: 最终验收测试 (1小时连续运行) 

## 4. 资源配置 (Resource Plan)
- 团队 (8-10人)
    - 需要额外补充 1x 机械/电气工程师
    
- 核心物料预算
    - 天机 Marvin 上半身 (定制)
    - 2套 Atlas Copco 拧紧系统
    - 3-4套 MecMind 3D相机
    - Jetson AGX Orin 计算平台
    - 蔚来前顶板样件
