# ProjectGeodesic 开发路线图

## 总体计划

本文档记录3个并行/递进的开发方案，从无硬件验证到真实硬件集成。

---

## 方案A：无硬件快速验证 (1-2天) ⏳ 当前进行中

### 目标
在没有真实相机的情况下验证核心算法的正确性和稳定性。

### 阶段划分

#### Phase 1: 环境验证 (2小时)
- [ ] 验证Open3D安装和基本功能
- [ ] 验证ROS 2环境
- [ ] 验证PyQt6可用性
- [ ] 运行示例点云可视化

#### Phase 2: 算法单元测试 (1天)
- [ ] 创建测试数据集
  - 下载Open3D示例点云
  - 生成合成测试数据（平面、几何体）
  - 创建带噪声的测试数据
- [ ] 测试点云预处理模块
  - 体素降采样
  - 统计去噪
  - 法向量估计
- [ ] 测试配准算法
  - PCA粗配准
  - ICP精配准
  - Point-to-Plane ICP
  - 评估配准精度
- [ ] 测试模板管理器
  - 保存/加载模板
  - 孔位标注
  - JSON序列化

#### Phase 3: 示教界面测试 (半天)
- [ ] 加载示例点云到GUI
- [ ] 练习孔位标注操作
- [ ] 保存测试模板
- [ ] 验证模板数据格式

#### Phase 4: ROS 2节点测试 (半天)
- [ ] 启动测试相机节点（发布合成数据）
- [ ] 启动配准节点
- [ ] 验证话题发布
- [ ] 检查配准状态输出

#### 交付标准
- ✅ 所有单元测试通过
- ✅ 能够使用测试数据完成完整配准流程
- ✅ 配准精度在合理范围内（RMS < 5mm for synthetic data）
- ✅ GUI能够正常标注和保存模板

---

## 方案B：真实相机集成 (1周) 📋 待开始

### 目标
连接MecMind相机，获取真实工件点云数据，验证算法在实际场景中的表现。

### 阶段划分

#### Week 1: 相机连接与数据采集 (3-4天)

#### Day 1-2: 相机硬件连接
- [ ] 安装MecMind SDK
  - 下载官方SDK和驱动
  - 安装依赖库
  - 配置环境变量
- [ ] 测试相机连接
  - 连接相机（USB/GigE/其他接口）
  - 使用官方工具测试采集
  - 验证相机参数（分辨率、帧率、视场角）
- [ ] 创建ROS 2相机驱动节点
  - 基于SDK Python/C++ API
  - 发布PointCloud2消息
  - 添加相机内参标定支持

#### Day 3-4: 标准件数据采集
- [ ] 准备标准工件
  - 清洁工件表面
  - 准备工装台车
  - 设置理想位置
- [ ] 优化光照条件
  - 测试不同光照强度
  - 减少反光和阴影
  - 记录最佳光照参数
- [ ] 多角度采集
  - 从相机视野采集多个点云
  - 选择质量最好的作为模板
  - 保存原始点云数据

#### Week 1 后半: 模板创建 (2-3天)

#### Day 5: 示教界面实战
- [ ] 加载标准件点云到GUI
- [ ] 人工标注13个螺丝孔
  - 按顺序标注（1-13）
  - 记录孔位类型（corner/edge/standard）
  - 验证标注合理性
- [ ] 保存第一个工件模板
  - 模板ID: `nio_front_roof_v1`
  - 附带元数据（光照、相机参数等）

#### Day 6-7: 配准验证
- [ ] 随机放置工件测试
  - 改变工件位置（至少5个不同位置）
  - 改变工件姿态（倾斜、旋转）
  - 测试极端情况（边缘位置）
- [ ] 评估配准精度
  - 粗配准误差 < 20mm
  - 精配准误差 < 2mm
  - 配准成功率 > 90%
- [ ] 调优参数
  - 调整体素大小
  - 调整ICP对应距离阈值
  - 切换PCA/FPFH粗配准方法

#### 交付标准
- ✅ MecMind相机成功接入ROS 2
- ✅ 采集到高质量的标准件点云
- ✅ 创建首个工件模板（13孔标注完整）
- ✅ 配准精度达到设计指标
- ✅ 文档记录最佳实践（光照、相机参数等）

---

## 方案C：仿真环境搭建 (并行进行，2周) 📋 待开始

### 目标
在NVIDIA Isaac Sim中搭建仿真环境，实现从仿真到现实的验证。

### 阶段划分

#### Week 1: 场景搭建

#### Day 1-3: Isaac Sim环境配置
- [ ] 安装Isaac Sim
  - 下载并安装Isaac Sim 2023+
  - 配置Python环境
  - 验证ROS 2 bridge
- [ ] 创建基础场景
  - 添加地面和工作台
  - 设置环境光照
  - 配置物理引擎参数

#### Day 4-5: 导入3D模型
- [ ] 工件模型
  - 获取前顶板CAD模型（STEP/STL）
  - 转换为URDF/Mesh格式
  - 添加材质（反光、黑色）
- [ ] 相机模型
  - 添加深度相机传感器
  - 配置相机内参（模拟MecMind）
  - 设置相机安装位置

#### Week 2: 仿真验证

#### Day 6-8: 点云数据导出
- [ ] 设置仿真场景
  - 放置工件在不同位置
  - 添加随机扰动
  - 设置多种光照条件
- [ ] 导出仿真点云
  - 通过ROS 2话题发布
  - 保存为PCD格式文件
  - 批量生成测试数据集

#### Day 9-10: 算法验证
- [ ] 在仿真数据上测试配准算法
  - 使用真实代码处理仿真数据
  - 对比不同位置/姿态的配准结果
  - 统计配准精度分布
- [ ] 评估Sim-to-Real gap
  - 仿真精度 vs 预期真实精度
  - 识别仿真偏差来源
  - 调整仿真参数缩小差距

#### 优势
- 🔒 安全：不会损坏真实设备
- 🔄 可控：精确控制测试条件
- 📊 可重复：相同条件多次测试
- 🚀 加速：快速迭代算法

#### 交付标准
- ✅ Isaac Sim场景搭建完成
- ✅ 能导出与真实相机类似的点云
- ✅ 生成多样化的测试数据集
- ✅ 验证算法在仿真中的表现
- ✅ 评估Sim-to-Real差距

---

## 方案间关系

```
方案A (无硬件验证)
    ↓
    ├→ 验证通过 ──→ 方案B (真实硬件)
    │                   ↓
    │              方案C (仿真) ← 可并行
    │                   ↓
    └─────────────→ 算法优化 ←────────┘
                        ↓
                   生产部署
```

**推荐策略：**
1. **立即开始方案A** - 快速发现代码问题
2. **等待硬件期间进行方案C** - 准备仿真环境
3. **硬件到位后全力投入方案B** - 获取真实数据验证

---

## 后续开发（完成3个方案后）

### Phase 6: 视觉伺服模块 (Month 2)
- [ ] IBVS视觉伺服实现
- [ ] 手腕相机集成
- [ ] 孔位精对准算法

### Phase 7: 运动规划 (Month 2-3)
- [ ] MoveIt 2配置
- [ ] 轨迹规划
- [ ] 碰撞检测

### Phase 8: 力控拧紧 (Month 3)
- [ ] 螺旋搜索算法
- [ ] 阻抗控制
- [ ] 拧紧枪集成

### Phase 9: LLM行为树 (Month 4)
- [ ] 大模型集成
- [ ] 行为树生成
- [ ] 任务规划测试

---

## 里程碑与时间线

| 周次 | 方案A | 方案B | 方案C | 里程碑 |
|------|-------|-------|-------|--------|
| Week 1 | ✅ 完成 | 相机连接 | Isaac Sim安装 | 环境就绪 |
| Week 2 | | 模板创建 | 场景搭建 | 首个模板 |
| Week 3 | | 配准验证 | 仿真测试 | 精度达标 |
| Week 4 | | 优化调优 | 数据集生成 | 准备集成 |

---

## 风险与应对

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 方案A测试失败 | 阻塞后续开发 | 中 | 先用最简单算法验证，逐步复杂化 |
| 相机SDK问题 | 延迟方案B | 高 | 准备备选方案（其他相机或仿真优先） |
| 仿真数据偏差大 | 影响算法可信度 | 中 | 同时进行小规模真实测试对比 |
| 配准精度不达标 | 需要算法改进 | 中 | 准备多种配准算法备选 |

---

## 资源需求

### 硬件
- ✅ 开发机 (RTX 5090 / Jetson AGX Orin)
- ⏳ MecMind 3D相机
- ⏳ 标准工件样件
- ⏳ 工装台车

### 软件
- ✅ ROS 2 Humble
- ✅ Open3D 0.18+
- ✅ Python 3.10+
- ⏳ Isaac Sim 2023+
- ⏳ MecMind SDK

### 人力
- 算法工程师 1人 (全职)
- 视觉工程师 1人 (兼职/全职)
- 机械/电气支持 1人 (按需)

---

**文档状态:** 活跃维护
**最后更新:** 2025-02-24
**当前阶段:** 方案A - 无硬件快速验证
